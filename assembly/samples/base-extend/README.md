# Sample: Base-Extend

This is a multi-module Maven project to demonstrate how the [*HiSrc HigherJAXB Maven Plugin*][2] can be configured to use a [base dependency (jar)][20] to provide an XML Schema (xsd) to a [second project][40] for import and extension.

### Problem ( from [StackOverflow](https://stackoverflow.com/questions/75874934/) )

How to extend a [base schema][21], using JAXB, in a [secondary project][41]?

### Solution

The [*HiSrc HigherJAXB Maven Plugin*][2] is a fork of *maven-jaxb2-plugin* that can be used to demonstrate this [solution (zip)][10]. The solution includes a *catalog* and an *episode* configuration to generate JAXB classes from [basemodel.xsd][21] and [model2.xsd][41] where the second schema imports the first schema to extend a complex type named `requestBase` and defines an element/type named `testInfo`.

>A [*catalog*][5] is a logical structure that contains "mapping" information. In order to make optimal use of the information about an XML external resource, there needs to be some interoperable way to map the information in an XML external identifier into a URI reference for the desired resource.

>An [*episode*][6] file, typically `*META-INF/sun-jaxb.episode*`, is generated by the XJC (XML Schema to Java) compiler. It is a schema [bindings][3] file that associates schema types with *existing* classes. It is useful when you have one XML schema that is imported by other schemas, as it prevents the model from being regenerated. XJC will scan JARs for `*.episode files`, then use them as binding files automatically.

#### Execution

This [solution (zip)][10] is a stand-alone, multi-module Maven project. You can run the test(s) using:

~~~
mvn -Pall,test clean test
mvn -Ptest clean install
cd extend
mvn -Ptest clean test
mvn -Pexec clean compile exec:java
~~~

Only the first execution is necessary to demonstrate the solution and this [output][12] shows the test results. The other executions provide more insight, as follows:

`mvn -Pall,test clean test`
: This solution contains a top-level [POM][13] project with two sub-modules: `base` and `extend`. The goal of this first execution is to `clean`, `compile` and `test` *all* three projects using the Maven [*reactor*][7]. **Note: ** The reactor keeps all modules on the classpath; thus, the `extend` module is able to resolve the `base` module, *cleverly*.

`mvn -Ptest clean install`
: To resolve the `base` artifact *outside* of the reactor, you need to install the artifact into your local repository. **Note:** A profile named `test` is used to add the [SLF4J][8] *implementation* into the build for its test phase, only.

`cd extend`
: Change to the `extend` sub-module for testing and execution outside of the multi-module reactor.

`mvn -Ptest clean test`
: Perform a clean test using the `test` profile for [unit testing][49].

`mvn -Pexec clean compile exec:java`
: Execute a simple Java [application][44] to demonstrate the unmarshalling of this sample [TestInfo.xml][45]. **Note:** The `exec` profile adds the [simplelogger.properties][48] and [SLF4J][8] *implementation* into the classpath for this execution only.

#### Catalog and Episode Configuration

Because [model2.xsd][41] imports the namespace defined in [basemodel.xsd][21], a [catalog.xml][42] is required to resolve the physical location using [MavenCatalogResolver][60].

**model2.xsd**
~~~
...
<xs:import namespace="h-spamfilter-p://it.test.base.model"/>
...
~~~

In this case, the `namespace` *is* the public identifier for the catalog's `publicId`.

**catalog.xml**
~~~
...
<public
    publicId="h-spamfilter-p://it.test.base.model"
    uri="maven:org.patrodyne.jvnet:hisrc-higherjaxb-sample-base-extend-base!/basemodel.xsd"
/>
...
~~~

The catalog resolves the `publicId` to a `uri`, the physical location. In this case, the physical location is inside of the `base` jar.

#### Episodes Configuration

Because the [base][20] module generates and provides the `RequestBase` class, you need to configure the [extend][40] module to use the `*META-INF/sun-jaxb.episode*` [bindings][3] from the [base][20] module.

**extend/pom.xml**
~~~
...
<plugin>
    <groupId>org.patrodyne.jvnet</groupId>
    <artifactId>hisrc-higherjaxb-maven-plugin</artifactId>
    <executions>
        <execution>
            <goals>
                <goal>generate</goal>
            </goals>
            <configuration>
                <episodes>
                    <episode>
                        <groupId>org.patrodyne.jvnet</groupId>
                        <artifactId>hisrc-higherjaxb-sample-base-extend-base</artifactId>
                    </episode>
                </episodes>
                <!-- Using catalogs to resolve schema URIs in strict mode is known to be problematic and may fail. -->
                <strict>false</strict>
                <catalog>src/main/resources/catalog.xml</catalog>
            </configuration>
        </execution>
    </executions>
</plugin>
...
~~~

> **Important:** You must configure the plugin to use your [catalog.xml][42] file!

#### JAXB Class and Episode Generation

The multi-module Maven project generates these JAXB classes, where `TestInfo.java` extends `RequestBase.java`:

**`base/target/generated-sources/xjc`**
~~~
├── h_spamfilter_p
│   └── it_test_base
│       ├── ObjectFactory.java
│       ├── package-info.java
│       └── RequestBase.java
└── META-INF
    └── sun-jaxb.episode
~~~

**`extend/target/generated-sources/xjc`**
~~~
├── h_spamfilter_p
│   └── it_test
│       ├── ObjectFactory.java
│       ├── package-info.java
│       └── TestInfo.java
└── META-INF
    └── sun-jaxb.episode
~~~

#### Testing

The JUnit test classes, [RequestBaseTest][28] and [TestInfoTest][49], scan for the sample file(s) and invoke the method `checkSample(File sample)` to provide each file to the tester. For this project, a `JAXBContext` is created and each file in the samples path is *unmarshaled* to a `base-extend` object. When successful, the `base-extend` object is *marshaled* for logging and your review.

<!-- References -->

[1]: https://github.com/patrodyne/hisrc-basicjaxb#readme
[2]: https://github.com/patrodyne/hisrc-higherjaxb#readme
[3]: https://jakarta.ee/specifications/xml-binding/
[4]: https://www.oasis-open.org/committees/entity/spec.html#s.intro
[5]: https://www.oasis-open.org/committees/entity/specs/cs-entity-xml-catalogs-1.0.html
[6]: https://eclipse-ee4j.github.io/jaxb-ri/3.0.0/docs/ch04.html#d0e4732
[7]: https://maven.apache.org/guides/mini/guide-multiple-modules.html
[8]: https://www.slf4j.org/
[10]: https://github.com/patrodyne/hisrc-higherjaxb/releases/download/2.1.0/hisrc-higherjaxb-sample-base-extend-2.1.0-mvn-src.zip
[11]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/README.md
[12]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/OUTPUT.txt
[13]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/project-pom.xml
[20]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/base/project-pom.xml
[21]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/base/src/main/resources/basemodel.xsd
[22]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/base/src/main/resources/basemodel.xjb
[23]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/base/src/main/java/h_spamfilter_p/it_test_base/Main.java
[24]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/base/src/test/samples/RequestBase.xml
[25]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/base/src/test/resources/jvmsystem.arguments
[26]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/base/src/test/resources/jvmsystem.properties
[27]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/base/src/test/resources/simplelogger.properties
[28]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/base/src/test/java/h_spamfilter_p/it_test_base/RequestBaseTest.java
[40]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/project-pom.xml
[41]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/src/main/resources/model2.xsd
[42]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/src/main/resources/catalog.xml
[43]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/src/main/resources/model2.xjb
[44]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/src/main/java/h_spamfilter_p/it_test/Main.java
[45]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/src/test/samples/TestInfo.xml
[46]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/src/test/resources/jvmsystem.arguments
[47]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/src/test/resources/jvmsystem.properties
[48]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/src/test/resources/simplelogger.properties
[49]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/assembly/samples/base-extend/extend/src/test/java/h_spamfilter_p/it_test/TestInfoTest.java
[60]: https://github.com/patrodyne/hisrc-higherjaxb/blob/master/plugin-core/src/main/java/org/jvnet/higherjaxb/mojo/resolver/tools/MavenCatalogResolver.java


